{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./resources/assets/dcat/extra/upload.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","w","$","Uploader","opts","extend","wrapper","addFileButton","inputSelector","isImage","preview","server","updateServer","autoUpload","sortable","deleteUrl","deleteData","thumbHeight","disabled","autoUpdateColumn","disableRemove","dimensions","lang","exceed_size","interrupt","upload_failed","selected_files","selected_has_failed","selected_success","dot","failed_num","pause_upload","go_on_upload","start_upload","upload_success_message","go_on_add","Q_TYPE_DENIED","Q_EXCEED_NUM_LIMIT","F_EXCEED_SIZE","Q_EXCEED_SIZE_LIMIT","F_DUPLICATE","confirm_delete_file","upload","formData","_id","thumb","width","height","quality","allowMagnify","crop","preserveHeaders","type","$selector","selector","updateColumn","upload_column","Math","floor","random","relation","_relation","elementName","$wrap","$queue","$statusBar","$info","$upload","$placeHolder","$progress","uploader","initImg","data","support","Dcat","showImg","originalFilesNum","helpers","len","$input","find","getFileViewSelector","fileId","replace","getFileView","addFileButtonSelector","faildFiles","formFiles","fileCount","fileSize","state","percentages","isSupportBase64","Image","onload","onerror","this","src","flashVersion","version","navigator","plugins","description","ex","ActiveXObject","GetVariable","ex2","match","parseFloat","file","Translator","__","trans","uploadedFiles","addFile","$li","$btns","size","WebUploader","formatSize","fileName","id","ext","toUpperCase","appendTo","nam","showError","code","text","setTimeout","css","margin","getStatus","statusText","image","makeThumb","error","img","empty","show","append","once","_info","info","_meta","meta","isset","validateDimensions","removeFile","resize","e","rotation","on","cur","prev","hide","remove","removeClass","addClass","deleteInput","serverId","confirm","post","_column","loading","result","status","message","previewImage","attr","orderFiles","apply","removeUploadFile","updateTotalProgress","off","end","percent","loaded","total","$bar","each","k","v","round","updateStatusText","stats","showSuccess","getStats","successNum","num","success","uploadFailNum","fail","html","setState","val","args","removeAttr","refreshButton","removeValidatorErrors","fileNumLimit","request","numOfSuccess","location","reload","fileLimit","option","removeFormFile","fake","getInput","split","addInput","push","setInput","arr","filter","self","indexOf","join","appendUploadedFile","searchUploadedFile","swrapUploadedFile","order","index","parseInt","currentFile","prevFile","nextFile","files","syncUploadedFiles","rerenderUploadedFiles","appendUploadedFileForm","refresh","parents","$this","first","$prev","$next","next","length","serverPath","serverUrl","deleteFile","click","url","options","build","browser","ie","container","window","swf","supportIe","items","denied","addButton","label","onUploadProgress","percentage","onBeforeFileQueued","onFileQueued","onFileDequeued","obj","reason","values","form","updateFileColumn","merge","serverName","path","onError","warning","hasClass","stop","retry","pop","addFileView","removeUploadFileView","getColumn","jQuery"],"mappings":"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","file":"/resources/dist/dcat/extra/upload.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 14);\n","(function (w, $) {\r\n    function Uploader(opts) {\r\n        opts = $.extend({\r\n            wrapper: '.web-uploader', // 图片显示容器选择器\r\n            addFileButton: '.add-file-button', // 继续添加按钮选择器\r\n            inputSelector: '',\r\n            isImage: false,\r\n            preview: [], // 数据预览\r\n            server: '',\r\n            updateServer: '',\r\n            autoUpload: false,\r\n            sortable: false,\r\n            deleteUrl: '',\r\n            deleteData: {},\r\n            thumbHeight: 160,\r\n            disabled: false, // 禁止任何上传编辑\r\n            autoUpdateColumn: false,\r\n            disableRemove: false, // 禁止删除图片，允许替换\r\n            dimensions: {\r\n                // width: 100, // 图片宽限制\r\n                // height: 100, // 图片高限制\r\n                // min_width: 100, //\r\n                // min_height: 100,\r\n                // max_width: 100,\r\n                // max_height: 100,\r\n                // ratio: 3/2, // 宽高比\r\n            },\r\n            lang: {\r\n                exceed_size: '文件大小超出',\r\n                interrupt: '上传暂停',\r\n                upload_failed: '上传失败，请重试',\r\n                selected_files: '选中:num个文件，共:size。',\r\n                selected_has_failed: '已成功上传:success个文件，:fail个文件上传失败，<a class=\"retry\"  href=\"javascript:\"\";\">重新上传</a>失败文件或<a class=\"ignore\" href=\"javascript:\"\";\">忽略</a>',\r\n                selected_success: '共:num个(:size)，已上传:success个。',\r\n                dot: '，',\r\n                failed_num: '失败:fail个。',\r\n                pause_upload: '暂停上传',\r\n                go_on_upload: '继续上传',\r\n                start_upload: '开始上传',\r\n                upload_success_message: '已成功上传:success个文件',\r\n                go_on_add: '继续添加',\r\n                Q_TYPE_DENIED: '对不起，不允许上传此类型文件',\r\n                Q_EXCEED_NUM_LIMIT: '对不起，已超出文件上传数量限制，最多只能上传:num个文件',\r\n                F_EXCEED_SIZE: '对不起，当前选择的文件过大',\r\n                Q_EXCEED_SIZE_LIMIT: '对不起，已超出文件大小限制',\r\n                F_DUPLICATE: '文件重复',\r\n                confirm_delete_file: '您确定要删除这个文件吗？',\r\n            },\r\n            upload: { // web-uploader配置\r\n                formData: {\r\n                    _id: null, // 唯一id\r\n                },\r\n                thumb: {\r\n                    width: 160,\r\n                    height: 160,\r\n                    quality: 70,\r\n                    allowMagnify: true,\r\n                    crop: true,\r\n                    preserveHeaders: false,\r\n                    // 为空的话则保留原有图片格式。\r\n                    // 否则强制转换成指定的类型。\r\n                    // IE 8下面 base64 大小不能超过 32K 否则预览失败，而非 jpeg 编码的图片很可\r\n                    // 能会超过 32k, 所以这里设置成预览的时候都是 image/jpeg\r\n                    type: 'image/jpeg'\r\n                },\r\n            }\r\n        }, opts);\r\n\r\n        var $selector = $(opts.selector),\r\n            updateColumn = opts.upload.formData.upload_column || ('webup' + Math.floor(Math.random()*10000)),\r\n            relation = opts.upload.formData._relation, // 一对多关联关系名称\r\n            elementName = opts.elementName;\r\n\r\n        if (typeof opts.upload.formData._id == \"undefined\" || !opts.upload.formData._id) {\r\n            opts.upload.formData._id = updateColumn + Math.floor(Math.random()*10000);\r\n        }\r\n\r\n        let Dcat = w.Dcat,\r\n\r\n            $wrap,\r\n\r\n            // 展示图片\r\n            showImg = opts.isImage,\r\n\r\n            // 图片容器\r\n            $queue,\r\n\r\n            // 状态栏，包括进度和控制按钮\r\n            $statusBar,\r\n\r\n            // 文件总体选择信息。\r\n            $info,\r\n\r\n            // 上传按钮\r\n            $upload,\r\n\r\n            // 没选择文件之前的内容。\r\n            $placeHolder,\r\n\r\n            $progress,\r\n\r\n            // 已上传文件数量\r\n            originalFilesNum = Dcat.helpers.len(opts.preview),\r\n\r\n            // 上传表单\r\n            $input = $selector.find(opts.inputSelector),\r\n\r\n            // 获取文件视图选择器\r\n            getFileViewSelector = function (fileId) {\r\n                return elementName.replace(/[\\[\\]]*/g, '_')+'-'+fileId;\r\n            },\r\n\r\n            getFileView = function (fileId) {\r\n                return $('#' + getFileViewSelector(fileId));\r\n            },\r\n\r\n            // 继续添加按钮选择器\r\n            addFileButtonSelector = opts.addFileButton,\r\n\r\n            // 临时存储上传失败的文件，key为file id\r\n            faildFiles = {},\r\n\r\n            // 临时存储添加到form表单的文件\r\n            formFiles = {},\r\n\r\n            // 添加的文件数量\r\n            fileCount = 0,\r\n\r\n            // 添加的文件总大小\r\n            fileSize = 0,\r\n\r\n            // 可能有pedding, ready, uploading, confirm, done.\r\n            state = 'pedding',\r\n\r\n            // 所有文件的进度信息，key为file id\r\n            percentages = {},\r\n            // 判断浏览器是否支持图片的base64\r\n            isSupportBase64 = (function () {\r\n                var data = new Image();\r\n                var support = true;\r\n                data.onload = data.onerror = function () {\r\n                    if (this.width != 1 || this.height != 1) {\r\n                        support = false;\r\n                    }\r\n                };\r\n                data.src = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==\";\r\n                return support;\r\n            })(),\r\n\r\n            // 检测是否已经安装flash，检测flash的版本\r\n            flashVersion = (function () {\r\n                var version;\r\n\r\n                try {\r\n                    version = navigator.plugins['Shockwave Flash'];\r\n                    version = version.description;\r\n                } catch (ex) {\r\n                    try {\r\n                        version = new ActiveXObject('ShockwaveFlash.ShockwaveFlash')\r\n                            .GetVariable('$version');\r\n                    } catch (ex2) {\r\n                        version = '0.0';\r\n                    }\r\n                }\r\n                version = version.match(/\\d+/g);\r\n                return parseFloat(version[0] + '.' + version[1], 10);\r\n            })(),\r\n\r\n            // 判断是否是图片\r\n            isImage = function (file) {\r\n                return file.type.match(/^image/);\r\n            },\r\n\r\n            // 翻译\r\n            lang = Dcat.Translator(opts.lang),\r\n            __ = lang.trans.bind(lang),\r\n\r\n            // WebUploader实例\r\n            uploader,\r\n\r\n            // 已上传的文件\r\n            uploadedFiles = [],\r\n\r\n            initImg;\r\n\r\n        // 当有文件添加进来时执行，负责view的创建\r\n        function addFile(file) {\r\n            var size = WebUploader.formatSize(file.size), $li, $btns, fileName = file.name || null;\r\n\r\n            if (showImg) {\r\n                $li = $(`<li id=\"${getFileViewSelector(file.id)}\" title=\"${fileName}\" >\r\n                    <p class=\"file-type\">${(file.ext.toUpperCase() || 'FILE')}</p>\r\n                    <p class=\"imgWrap \"></p>\r\n                    <p class=\"title\" style=\"\">${file.name}</p>\r\n                    <p class=\"title\" style=\"margin-bottom:20px;\">(<b>${size}</b>)</p>\r\n                    </li>`);\r\n\r\n                $btns = $(`<div class=\"file-panel\">\r\n                    <a class=\"btn btn-sm btn-white\" data-file-act=\"cancel\"><i class=\"feather icon-x red-dark\" style=\"font-size:13px\"></i></a>\r\n                    <a class=\"btn btn-sm btn-white\" data-file-act=\"delete\" style=\"display: none\">\r\n                    <i class=\"feather icon-trash red-dark\" style=\"font-size:13px\"></i></a>\r\n                    <a class=\"btn btn-sm btn-white\" data-file-act=\"preview\" ><i class=\"feather icon-zoom-in\"></i></a>\r\n                    <a class='btn btn-sm btn-white' data-file-act='order' data-order=\"1\" style=\"display: none\"><i class='feather icon-arrow-up'></i></a>\r\n                    <a class='btn btn-sm btn-white' data-file-act='order' data-order=\"0\" style=\"display: none\"><i class='feather icon-arrow-down'></i></a>\r\n\r\n                    </div>`).appendTo($li);\r\n            } else {\r\n                $li = $(`\r\n                    <li id=\"${getFileViewSelector(file.id)}\" title=\"${file.nam}\">\r\n                    <p class=\"title\" style=\"display:block\">\r\n                        <i class=\"feather icon-check green _success icon-success\"></i>\r\n                        ${file.name} (${size})\r\n                    </p>\r\n                    </li>\r\n                `);\r\n\r\n                $btns = $(`\r\n<span style=\"right: 45px;\" class=\"file-action d-none\" data-file-act='order' data-order=\"1\"><i class='feather icon-arrow-up'></i></span>\r\n<span style=\"right: 25px;\" class=\"file-action d-none\" data-file-act='order' data-order=\"0\"><i class='feather icon-arrow-down'></i></span>\r\n<span data-file-act=\"cancel\" class=\"file-action\" style=\"font-size:13px\">\r\n    <i class=\"feather icon-x red-dark\"></i>\r\n</span>\r\n<span data-file-act=\"delete\" class=\"file-action\" style=\"display:none\">\r\n    <i class=\"feather icon-trash red-dark\"></i>\r\n</span>\r\n`).appendTo($li);\r\n            }\r\n\r\n            var $wrap = $li.find('p.imgWrap'),\r\n                $info = $('<p class=\"error\"></p>'),\r\n\r\n                showError = function (code, file) {\r\n                    var text = '';\r\n                    switch (code) {\r\n                        case 'exceed_size':\r\n                            text = __('exceed_size');\r\n                            break;\r\n\r\n                        case 'interrupt':\r\n                            text = __('interrupt');\r\n                            break;\r\n\r\n                        default:\r\n                            text = __('upload_failed');\r\n                            break;\r\n                    }\r\n\r\n                    faildFiles[file.id] = file;\r\n\r\n                    $info.text(text).appendTo($li);\r\n                };\r\n\r\n            $li.appendTo($queue);\r\n\r\n            setTimeout(function () {\r\n                $li.css({margin: '5px'});\r\n            }, 50);\r\n\r\n            if (file.getStatus() === 'invalid') {\r\n                showError(file.statusText, file);\r\n            } else {\r\n                if (showImg) {\r\n                    var image = uploader.makeThumb(file, function (error, src) {\r\n                        var img;\r\n\r\n                        $wrap.empty();\r\n                        if (error) {\r\n                            $li.find('.title').show();\r\n                            $li.find('.file-type').show();\r\n                            return;\r\n                        }\r\n\r\n                        if (isSupportBase64) {\r\n                            img = $('<img src=\"' + src + '\">');\r\n                            $wrap.append(img);\r\n                        } else {\r\n                            $li.find('.file-type').show();\r\n                        }\r\n                    });\r\n\r\n                    try {\r\n                        image.once('load', function () {\r\n                            file._info = file._info || image.info();\r\n                            file._meta = file._meta || image.meta();\r\n                            var width = file._info.width,\r\n                                height = file._info.height;\r\n\r\n                            if (!validateDimensions(file)) {\r\n                                Dcat.error('The image dimensions is invalid.');\r\n                                uploader.removeFile(file);\r\n                                return false;\r\n                            }\r\n\r\n                            image.resize(width, height);\r\n                        });\r\n                    } catch (e) {\r\n                        // 不是图片\r\n                        return setTimeout(function () {\r\n                            uploader.removeFile(file);\r\n                        }, 10);\r\n                    }\r\n                }\r\n\r\n                percentages[file.id] = [file.size, 0];\r\n                file.rotation = 0;\r\n            }\r\n\r\n            file.on('statuschange', function (cur, prev) {\r\n                if (prev === 'progress') {\r\n                    // $prgress.hide().width(0);\r\n                } else if (prev === 'queued') {\r\n                    $btns.find('[data-file-act=\"cancel\"]').hide();\r\n                    $btns.find('[data-file-act=\"delete\"]').show();\r\n                }\r\n\r\n                // 成功\r\n                if (cur === 'error' || cur === 'invalid') {\r\n                    showError(file.statusText, file);\r\n                    percentages[file.id][1] = 1;\r\n                } else if (cur === 'interrupt') {\r\n                    showError('interrupt', file);\r\n                } else if (cur === 'queued') {\r\n                    percentages[file.id][1] = 0;\r\n                } else if (cur === 'progress') {\r\n                    $info.remove();\r\n                    // $prgress.css('display', 'block');\r\n                } else if (cur === 'complete') {\r\n                    if (showImg) {\r\n                        $li.append('<span class=\"success\"><em></em><i class=\"feather icon-check\"></i></span>');\r\n                    } else {\r\n                        $li.find('._success').show();\r\n                    }\r\n                }\r\n\r\n                $li.removeClass('state-' + prev).addClass('state-' + cur);\r\n            });\r\n\r\n            var $act = showImg ? $btns.find('a') : $btns;\r\n\r\n            $act.on('click', function () {\r\n                var index = $(this).data('file-act');\r\n\r\n                switch (index) {\r\n                    case 'cancel':\r\n                        uploader.removeFile(file);\r\n                        return;\r\n                    case 'deleteurl':\r\n                    case 'delete':\r\n                        if (opts.disableRemove) {\r\n                            deleteInput(file.serverId);\r\n                            return uploader.removeFile(file);\r\n                        }\r\n\r\n                        Dcat.confirm(__('confirm_delete_file'), file.serverId, function () {\r\n                            var post = opts.deleteData;\r\n\r\n                            post.key = file.serverId;\r\n                            if (!post.key) {\r\n                                deleteInput(file.serverId);\r\n                                return uploader.removeFile(file);\r\n                            }\r\n                            post._column = updateColumn;\r\n                            post._relation = relation;\r\n\r\n                            Dcat.loading();\r\n                            $.post(opts.deleteUrl, post, function (result) {\r\n                                Dcat.loading(false);\r\n                                if (result.status) {\r\n                                    deleteInput(file.serverId);\r\n                                    uploader.removeFile(file);\r\n                                    return;\r\n                                }\r\n\r\n                                Dcat.error(result.message || 'Remove file failed.');\r\n                            });\r\n\r\n                        });\r\n\r\n                        break;\r\n                    case 'preview':\r\n                        Dcat.helpers.previewImage($wrap.find('img').attr('src'), null, file.name);\r\n                        break;\r\n                    case 'order':\r\n                        $(this).attr('data-id', file.serverId);\r\n\r\n                        orderFiles.apply(this);\r\n                        break;\r\n                }\r\n\r\n            });\r\n        }\r\n\r\n        // 图片宽高验证\r\n        function validateDimensions(file) {\r\n            // The image dimensions is invalid.\r\n            if (!showImg || !isImage(file) || !Dcat.helpers.len(opts.dimensions)) return true;\r\n            var dimensions = opts.dimensions,\r\n                width = file._info.width,\r\n                height = file._info.height,\r\n                isset = Dcat.helpers.isset;\r\n            if (\r\n                (isset(dimensions, 'width') && dimensions['width'] != width) ||\r\n                (isset(dimensions, 'min_width') && dimensions['min_width'] > width)||\r\n                (isset(dimensions, 'max_width') && dimensions['max_width'] < width) ||\r\n                (isset(dimensions, 'height') && dimensions['height'] != height) ||\r\n                (isset(dimensions, 'min_height') && dimensions['min_height'] > height) ||\r\n                (isset(dimensions, 'max_height') && dimensions['max_height'] < height) ||\r\n                (isset(dimensions, 'ratio') && dimensions['ratio'] != (width / height))\r\n            ) {\r\n                return false;\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        // 负责view的销毁\r\n        function removeUploadFile(file) {\r\n            var $li = getFileView(file.id);\r\n\r\n            delete percentages[file.id];\r\n            updateTotalProgress();\r\n            $li.off().find('.file-panel').off().end().remove();\r\n        }\r\n\r\n        function updateTotalProgress() {\r\n            var loaded = 0,\r\n                total = 0,\r\n                $bar = $progress.find('.progress-bar'),\r\n                percent;\r\n\r\n            $.each(percentages, function (k, v) {\r\n                total += v[0];\r\n                loaded += v[0] * v[1];\r\n            });\r\n\r\n            percent = total ? loaded / total : 0;\r\n            percent = Math.round(percent * 100) + '%';\r\n\r\n            $bar.text(percent);\r\n            $bar.css('width', percent);\r\n            updateStatusText();\r\n        }\r\n\r\n        function updateStatusText() {\r\n            var text = '', stats;\r\n\r\n            if (!uploader) {\r\n                return;\r\n            }\r\n\r\n            if (state === 'ready') {\r\n                stats = uploader.getStats();\r\n                if (fileCount) {\r\n                    text = __('selected_files', {num: fileCount, size: WebUploader.formatSize(fileSize)});\r\n                } else {\r\n                    showSuccess();\r\n                }\r\n            } else if (state === 'confirm') {\r\n                stats = uploader.getStats();\r\n                if (stats.uploadFailNum) {\r\n                    text = __('selected_has_failed', {success: stats.successNum, fail: stats.uploadFailNum});\r\n                }\r\n            } else {\r\n                showSuccess();\r\n            }\r\n\r\n            function showSuccess() {\r\n                stats = uploader.getStats();\r\n                if (stats.successNum) {\r\n                    text = __('selected_success', {num: fileCount, size: WebUploader.formatSize(fileSize), success: stats.successNum});\r\n                }\r\n\r\n                if (stats.uploadFailNum) {\r\n                    text += (text ? __('dot') : '') + __('failed_num', {fail: stats.uploadFailNum});\r\n                }\r\n            }\r\n\r\n            $info.html(text);\r\n        }\r\n\r\n        // 上传文件后修改字段值\r\n        function updateFileColumn() {\r\n            var values = getInput(),\r\n                num = uploader.getStats().successNum,\r\n                form = $.extend({}, opts.formData);\r\n\r\n            if (!num || !values || !opts.autoUpdateColumn) {\r\n                return;\r\n            }\r\n\r\n            if (relation) {\r\n                if (! relation[1]) {\r\n                    // 新增子表记录，则不调用update接口\r\n                    return;\r\n                }\r\n\r\n                form[relation[0]] = {};\r\n\r\n                form[relation[0]][relation[1]] = {};\r\n                form[relation[0]][relation[1]][updateColumn] = values.join(',');\r\n            } else {\r\n                form[updateColumn] = values.join(',');\r\n            }\r\n\r\n            delete form['_relation'];\r\n            delete form['upload_column'];\r\n\r\n            $.post(opts.updateServer, form);\r\n        }\r\n\r\n        function setState(val, args) {\r\n            var stats;\r\n            args = args || {};\r\n\r\n            if (val === state) {\r\n                return;\r\n            }\r\n\r\n            if ($upload) {\r\n                $upload.removeClass('state-' + state);\r\n                $upload.addClass('state-' + val);\r\n            }\r\n            state = val;\r\n\r\n            switch (state) {\r\n                case 'pedding':\r\n                    if (opts.disabled) return;\r\n                    $placeHolder.removeClass('element-invisible');\r\n                    $queue.hide();\r\n                    $statusBar.addClass('element-invisible');\r\n                    if (showImg) {\r\n                        $wrap.removeAttr('style');\r\n                        $wrap.find('.queueList').removeAttr('style');\r\n                    }\r\n\r\n                    refreshButton();\r\n                    break;\r\n\r\n                case 'ready':\r\n                    $placeHolder.addClass('element-invisible');\r\n                    $selector.find(addFileButtonSelector).removeClass('element-invisible');\r\n                    $queue.show();\r\n                    if (! opts.disabled) {\r\n                        $statusBar.removeClass('element-invisible');\r\n                    }\r\n                    refreshButton();\r\n                    if (showImg) {\r\n                        $wrap.find('.queueList').css({'border': '1px solid #d3dde5', 'padding':'5px'});\r\n                        // $wrap.find('.queueList').removeAttr('style');\r\n                    }\r\n\r\n                    setTimeout(removeValidatorErrors, 1);\r\n                    break;\r\n\r\n                case 'uploading':\r\n                    $selector.find(addFileButtonSelector).addClass('element-invisible');\r\n                    $progress.show();\r\n                    $upload.text(__('pause_upload'));\r\n                    break;\r\n\r\n                case 'paused':\r\n                    $progress.show();\r\n                    $upload.text(__('go_on_upload'));\r\n                    break;\r\n\r\n                case 'confirm':\r\n                    if (uploader) {\r\n                        $progress.hide();\r\n                        $selector.find(addFileButtonSelector).removeClass('element-invisible');\r\n                        $upload.text(__('start_upload'));\r\n\r\n                        stats = uploader.getStats();\r\n                        if (stats.successNum && !stats.uploadFailNum) {\r\n                            setState('finish');\r\n                            return;\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'finish':\r\n                    if (uploader) {\r\n                        stats = uploader.getStats();\r\n                        if (stats.successNum) {\r\n                            Dcat.success(__('upload_success_message', {success: stats.successNum}));\r\n\r\n                            setTimeout(function () {\r\n                                if (opts.upload.fileNumLimit == 1) {\r\n                                    // 单文件上传，需要重置文件上传个数\r\n                                    uploader.request('get-stats').numOfSuccess = 0;\r\n                                }\r\n                            }, 10);\r\n\r\n                        } else {\r\n                            // 没有成功的图片，重设\r\n                            state = 'done';\r\n                            location.reload();\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'decrOriginalFileNum':\r\n                    if (originalFilesNum > 0) originalFilesNum --;\r\n                    break;\r\n\r\n                case 'incrOriginalFileNum':\r\n                    originalFilesNum ++;\r\n                    break;\r\n\r\n                case 'decrFileNumLimit': // 减少上传文件数量限制\r\n                    if (!uploader) {\r\n                        return;\r\n                    }\r\n                    var fileLimit = uploader.option('fileNumLimit'),\r\n                        num = args.num || 1;\r\n\r\n                    if (fileLimit == '-1') fileLimit = 0;\r\n\r\n                    num = fileLimit >= num ? fileLimit - num : 0;\r\n\r\n                    if (num == 0) num = '-1';\r\n\r\n                    uploader.option('fileNumLimit', num);\r\n\r\n                    break;\r\n                case 'incrFileNumLimit': // 增加上传文件数量限制\r\n                    if (!uploader) {\r\n                        return;\r\n                    }\r\n                    var fileLimit = uploader.option('fileNumLimit'),\r\n                        num = args.num || 1;\r\n\r\n                    if (fileLimit == '-1') fileLimit = 0;\r\n\r\n                    num = fileLimit + num;\r\n\r\n                    uploader.option('fileNumLimit', num);\r\n                    break;\r\n                case 'init': // 初始化\r\n                    $upload.addClass('state-' + state);\r\n                    updateTotalProgress();\r\n\r\n                    if (originalFilesNum || opts.disabled) {\r\n                        $placeHolder.addClass('element-invisible');\r\n                        if (!opts.disabled) {\r\n                            $statusBar.show();\r\n                        } else {\r\n                            $wrap.addClass('disabled');\r\n                        }\r\n                        setState('ready');\r\n                    } else if (showImg) {\r\n                        $wrap.removeAttr('style');\r\n                        $wrap.find('.queueList').css('margin', '0');\r\n                    }\r\n                    refreshButton();\r\n                    break;\r\n\r\n            }\r\n\r\n            updateStatusText();\r\n        }\r\n\r\n        // 移除form表单的文件\r\n        function removeFormFile(fileId) {\r\n            if (!fileId) return;\r\n\r\n            var file = formFiles[fileId];\r\n\r\n            deleteInput(fileId);\r\n            delete formFiles[fileId];\r\n            if (uploader && !file.fake) {\r\n                uploader.removeFile(file);\r\n            }\r\n\r\n            setState('decrOriginalFileNum');\r\n            setState('incrFileNumLimit');\r\n\r\n            if (!Dcat.helpers.len(formFiles) && !Dcat.helpers.len(percentages)) {\r\n                setState('pedding');\r\n            }\r\n        }\r\n\r\n        // 获取表单值\r\n        function getInput() {\r\n            var val = $input.val();\r\n\r\n            return val ? val.split(',') : [];\r\n        }\r\n\r\n        // 新增表单值\r\n        function addInput(id) {\r\n            var val = getInput();\r\n            val.push(id);\r\n            setInput(val);\r\n        }\r\n\r\n        // 设置表单值\r\n        function setInput(arr) {\r\n            arr = arr.filter(function(v, k, self) {\r\n                return self.indexOf(v) === k;\r\n            }).filter(function (v) {\r\n                return v ? true : false;\r\n            });\r\n\r\n            $input.val(arr.join(','));\r\n        }\r\n\r\n        // 删除表单值\r\n        function deleteInput(id) {\r\n            deleteUploadedFile(id);\r\n\r\n            if (!id) {\r\n                return $input.val('');\r\n            }\r\n            setInput(getInput().filter(function (v) {\r\n                return v != id;\r\n            }));\r\n        }\r\n\r\n        // 添加已上传文件\r\n        function appendUploadedFile(file) {\r\n            if (! file.serverId || searchUploadedFile(file.serverId) !== -1) {\r\n                return;\r\n            }\r\n\r\n            uploadedFiles.push(file)\r\n        }\r\n\r\n        function syncUploadedFiles() {\r\n            var files = [];\r\n            for (var i in uploadedFiles) {\r\n                if (uploadedFiles[i]) {\r\n                    files.push(uploadedFiles[i].serverId);\r\n                }\r\n            }\r\n\r\n            setInput(files);\r\n        }\r\n\r\n        function deleteUploadedFile(fileId) {\r\n            uploadedFiles = uploadedFiles.filter(function (v) {\r\n                return v.serverId != fileId;\r\n            });\r\n        }\r\n\r\n        // 查找文件位置\r\n        function searchUploadedFile(fileId) {\r\n            for (var i in uploadedFiles) {\r\n                if (uploadedFiles[i].serverId === fileId) {\r\n                    return i;\r\n                }\r\n            }\r\n\r\n            return -1;\r\n        }\r\n\r\n        // 交换文件排序\r\n        function swrapUploadedFile(fileId, order) {\r\n            var index = parseInt(searchUploadedFile(fileId)),\r\n                currentFile = uploadedFiles[index],\r\n                prevFile = uploadedFiles[index - 1],\r\n                nextFile = uploadedFiles[index + 1];\r\n\r\n            if (order) {\r\n                if (index === 0) {\r\n                    return;\r\n                }\r\n\r\n                uploadedFiles[index - 1] = currentFile;\r\n                uploadedFiles[index] = prevFile;\r\n            } else {\r\n                if (! nextFile) {\r\n                    return;\r\n                }\r\n\r\n                uploadedFiles[index + 1] = currentFile;\r\n                uploadedFiles[index] = nextFile;\r\n            }\r\n\r\n            syncUploadedFiles();\r\n        }\r\n\r\n        // 重新渲染已上传文件\r\n        function rerenderUploadedFiles() {\r\n            $queue.html('');\r\n\r\n            for (var i in uploadedFiles) {\r\n                if (uploadedFiles[i]) {\r\n                    appendUploadedFileForm(uploadedFiles[i])\r\n                }\r\n            }\r\n        }\r\n\r\n        // 重新计算按钮定位\r\n        function refreshButton() {\r\n            uploader.refresh();\r\n        }\r\n\r\n        function removeValidatorErrors() {\r\n            $input.parents('.form-group,.form-label-group,.form-field').find('.with-errors').html('')\r\n        }\r\n\r\n        // 文件排序\r\n        function orderFiles() {\r\n            var $this = $(this),\r\n                $li = $this.parents('li').first(),\r\n                fileId = $this.data('id'),\r\n                order = $this.data('order'),\r\n                $prev = $li.prev(),\r\n                $next = $li.next();\r\n\r\n            if (order) {\r\n                // 升序\r\n                if (! $prev.length) {\r\n                    return;\r\n                }\r\n                swrapUploadedFile(fileId, order);\r\n                rerenderUploadedFiles();\r\n\r\n                return;\r\n            }\r\n\r\n            if (! $next.length) {\r\n                return;\r\n            }\r\n\r\n            swrapUploadedFile(fileId, order);\r\n            rerenderUploadedFiles();\r\n        }\r\n\r\n        // 添加上传成功文件到表单区域\r\n        function appendUploadedFileForm(file) {\r\n            var html = \"\";\r\n            html += \"<li title='\" + file.serverPath + \"'>\";\r\n\r\n            if (! showImg && opts.sortable) {\r\n                // 文件排序\r\n                html += `\r\n<p style=\"right: 45px\" class=\"file-action\" data-file-act='order' data-order=\"1\" data-id='${file.serverId}'><i class='feather icon-arrow-up'></i></p>\r\n<p style=\"right: 25px\" class=\"file-action\" data-file-act='order' data-order=\"0\" data-id='${file.serverId}'><i class='feather icon-arrow-down'></i></p>\r\n`;\r\n            }\r\n\r\n            if (showImg) {\r\n                html += `<p class='imgWrap'><img src='${file.serverUrl}'></p>`\r\n            } else if (! opts.disabled) {\r\n                html += `<p class=\"file-action\" data-file-act=\"delete\" data-id=\"${file.serverId}\"><i class=\"feather icon-trash red-dark\"></i></p>`;\r\n            }\r\n\r\n            html += \"<p class='title' style=''><i class='feather icon-check text-white icon-success text-white'></i>\";\r\n            html += file.serverPath;\r\n            html += \"</p>\";\r\n\r\n            if (showImg) {\r\n                html += \"<p class='title' style='margin-bottom:20px;'>&nbsp;</p>\";\r\n                html += \"<div class='file-panel' >\";\r\n\r\n                if (! opts.disabled) {\r\n                    html += `<a class='btn btn-sm btn-white' data-file-act='deleteurl' data-id='${file.serverId}'><i class='feather icon-trash red-dark' style='font-size:13px'></i></a>`;\r\n                }\r\n                html += `<a class='btn btn-sm btn-white' data-file-act='preview' data-url='${file.serverUrl}' ><i class='feather icon-zoom-in'></i></a>`;\r\n\r\n                if (opts.sortable) {\r\n                    // 文件排序\r\n                    html += `\r\n<a class='btn btn-sm btn-white' data-file-act='order' data-order=\"1\" data-id='${file.serverId}'><i class='feather icon-arrow-up'></i></a>\r\n<a class='btn btn-sm btn-white' data-file-act='order' data-order=\"0\" data-id='${file.serverId}'><i class='feather icon-arrow-down'></i></a>\r\n`;\r\n                }\r\n\r\n                html += \"</div>\";\r\n            } else {\r\n\r\n            }\r\n\r\n            html += \"</li>\";\r\n            html = $(html);\r\n\r\n            if (!showImg) {\r\n                html.find('.file-type').show();\r\n                html.find('.title').show();\r\n                $wrap.css('background', 'transparent');\r\n            }\r\n\r\n            var deleteFile = function () {\r\n                var fileId = $(this).data('id'), post = opts.deleteData;\r\n\r\n                if (opts.disableRemove) {\r\n                    html.remove();\r\n\r\n                    return removeFormFile(fileId);\r\n                }\r\n\r\n                Dcat.confirm(__('confirm_delete_file'), file.serverId, function () {\r\n                    post.key = fileId;\r\n                    post._column = updateColumn;\r\n                    post._relation = relation;\r\n\r\n                    Dcat.loading();\r\n                    $.post(opts.deleteUrl, post, function (result) {\r\n                        Dcat.loading(false);\r\n                        if (result.status) {\r\n                            // 移除\r\n                            html.remove();\r\n\r\n                            removeFormFile(fileId);\r\n                            return;\r\n                        }\r\n\r\n                        Dcat.error(result.message || 'Remove file failed.')\r\n                    });\r\n                });\r\n            };\r\n\r\n            // 删除按钮点击事件\r\n            html.find('[data-file-act=\"deleteurl\"]').click(deleteFile);\r\n            html.find('[data-file-act=\"delete\"]').click(deleteFile);\r\n\r\n            // 文件排序\r\n            if (opts.sortable) {\r\n                html.find('[data-file-act=\"order\"').click(orderFiles);\r\n            }\r\n\r\n            // 放大图片\r\n            html.find('[data-file-act=\"preview\"]').click(function () {\r\n                var url = $(this).data('url');\r\n\r\n                Dcat.helpers.previewImage(url);\r\n            });\r\n\r\n            formFiles[file.serverId] = file;\r\n\r\n            addInput(file.serverId);\r\n\r\n            $queue.append(html);\r\n\r\n            if (showImg) {\r\n                setTimeout(function () {\r\n                    html.css('margin', '5px');\r\n                }, initImg ? 0 : 400);\r\n\r\n                initImg = 1;\r\n            }\r\n        }\r\n\r\n        // 初始化web-uploader\r\n        function build() {\r\n            $wrap = $selector.find(opts.wrapper);\r\n\r\n            // 图片容器\r\n            $queue = $('<ul class=\"filelist\"></ul>').appendTo($wrap.find('.queueList'));\r\n\r\n            // 状态栏，包括进度和控制按钮\r\n            $statusBar = $wrap.find('.statusBar');\r\n\r\n            // 文件总体选择信息。\r\n            $info = $statusBar.find('.info');\r\n\r\n            // 上传按钮\r\n            $upload = $wrap.find('.upload-btn');\r\n\r\n            // 没选择文件之前的内容。\r\n            $placeHolder = $wrap.find('.placeholder');\r\n\r\n            $progress = $statusBar.find('.upload-progress').hide();\r\n\r\n            // IE;\r\n            supportIe();\r\n\r\n            // 实例化\r\n            this.uploader = uploader = WebUploader.create(opts.upload);\r\n\r\n            // 拖拽时不接受 js, txt 文件。\r\n            uploader.on('dndAccept', function (items) {\r\n                var denied = false,\r\n                    len = items.length,\r\n                    i = 0,\r\n                    // 修改js类型\r\n                    unAllowed = 'text/plain;application/javascript ';\r\n\r\n                for (; i < len; i++) {\r\n                    // 如果在列表里面\r\n                    if (~unAllowed.indexOf(items[i].type)) {\r\n                        denied = true;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                return !denied;\r\n            });\r\n\r\n            if (opts.upload.fileNumLimit > 1 && !opts.disabled) {\r\n                // 添加“添加文件”的按钮，\r\n                uploader.addButton({\r\n                    id: addFileButtonSelector,\r\n                    label: '<i class=\"feather icon-folder\"></i> &nbsp;' + __('go_on_add')\r\n                });\r\n            }\r\n\r\n            uploader.onUploadProgress = function (file, percentage) {\r\n                percentages[file.id][1] = percentage;\r\n                updateTotalProgress();\r\n            };\r\n\r\n            uploader.onBeforeFileQueued = function (file) {\r\n\r\n            };\r\n\r\n            // 添加文件\r\n            uploader.onFileQueued = function (file) {\r\n                fileCount++;\r\n                fileSize += file.size;\r\n\r\n                if (fileCount === 1) {\r\n                    $placeHolder.addClass('element-invisible');\r\n                    $statusBar.show();\r\n                }\r\n\r\n                addFile(file);\r\n                setState('ready');\r\n                updateTotalProgress();\r\n\r\n                if (! opts.disabled && opts.autoUpload) {\r\n                    // 自动上传\r\n                    uploader.upload()\r\n                }\r\n            };\r\n\r\n            // 删除文件事件监听\r\n            uploader.onFileDequeued = function (file) {\r\n                fileCount--;\r\n                fileSize -= file.size;\r\n\r\n                if (!fileCount && !Dcat.helpers.len(formFiles)) {\r\n                    setState('pedding');\r\n                }\r\n\r\n                removeUploadFile(file);\r\n            };\r\n\r\n            uploader.on('all', function (type, obj, reason) {\r\n                switch (type) {\r\n                    case 'uploadFinished':\r\n                        setState('confirm');\r\n                        updateFileColumn();\r\n                        break;\r\n\r\n                    case 'startUpload':\r\n                        setState('uploading');\r\n                        break;\r\n\r\n                    case 'stopUpload':\r\n                        setState('paused');\r\n                        break;\r\n                    case  'uploadAccept':\r\n                        // 上传失败，返回false\r\n                        if (reason && reason.error) {\r\n                            Dcat.error(reason.error.message);\r\n\r\n                            faildFiles[obj.file.id] = obj.file;\r\n\r\n                            return false;\r\n                        }\r\n\r\n                        if (reason.merge) {\r\n                            // 分片上传\r\n                            return;\r\n                        }\r\n\r\n                        // 上传成功，保存新文件名和路径到file对象\r\n                        obj.file.serverId   = reason.id;\r\n                        obj.file.serverName = reason.name;\r\n                        obj.file.serverPath = reason.path;\r\n                        obj.file.serverUrl  = reason.url || null;\r\n\r\n                        appendUploadedFile(obj.file);\r\n\r\n                        addInput(reason.id);\r\n\r\n                        var $li = getFileView(obj.file.id);\r\n\r\n                        if (!showImg) {\r\n                            $li.find('.file-action').hide();\r\n                            $li.find('[data-file-act=\"delete\"]').show();\r\n                        }\r\n\r\n                        if (opts.sortable) {\r\n                            $li.find('[data-file-act=\"order\"]').removeClass('d-none').show();\r\n                        }\r\n\r\n                        break;\r\n                }\r\n\r\n            });\r\n\r\n            uploader.onError = function (code) {\r\n                switch (code) {\r\n                    case 'Q_TYPE_DENIED':\r\n                        Dcat.error(__('Q_TYPE_DENIED'));\r\n                        break;\r\n                    case 'Q_EXCEED_NUM_LIMIT':\r\n                        Dcat.error(__('Q_EXCEED_NUM_LIMIT', {num: opts.upload.fileNumLimit}));\r\n                        break;\r\n                    case 'F_EXCEED_SIZE':\r\n                        Dcat.error(__('F_EXCEED_SIZE'));\r\n                        break;\r\n                    case 'Q_EXCEED_SIZE_LIMIT':\r\n                        Dcat.error(__('Q_EXCEED_SIZE_LIMIT'));\r\n                        break;\r\n                    case 'F_DUPLICATE':\r\n                        Dcat.warning(__('F_DUPLICATE'));\r\n                        break;\r\n                    default:\r\n                        Dcat.error('Error: ' + code);\r\n                }\r\n\r\n            };\r\n\r\n            $upload.on('click', function () {\r\n                if ($(this).hasClass('disabled')) {\r\n                    return false;\r\n                }\r\n\r\n                if (state === 'ready') {\r\n                    uploader.upload();\r\n                } else if (state === 'paused') {\r\n                    uploader.upload();\r\n                } else if (state === 'uploading') {\r\n                    uploader.stop();\r\n                }\r\n            });\r\n\r\n            $info.on('click', '.retry', function () {\r\n                uploader.retry();\r\n            });\r\n\r\n            $info.on('click', '.ignore', function () {\r\n                for (var i in faildFiles) {\r\n                    uploader.removeFile(i, true);\r\n                    delete faildFiles[i];\r\n                }\r\n\r\n            });\r\n\r\n            setState('init');\r\n        }\r\n\r\n        // 预览\r\n        function preview() {\r\n            for (var i in opts.preview) {\r\n                var path = opts.preview[i].path, ext;\r\n\r\n                if (path.indexOf('.')) {\r\n                    ext = path.split('.').pop();\r\n                }\r\n\r\n                var file = {\r\n                    serverId: opts.preview[i].id,\r\n                    serverUrl: opts.preview[i].url,\r\n                    serverPath: path,\r\n                    ext: ext,\r\n                    fake: 1,\r\n                };\r\n\r\n                setState('incrOriginalFileNum');\r\n                setState('decrFileNumLimit');\r\n\r\n                appendUploadedFileForm(file);\r\n                appendUploadedFile(file);\r\n            }\r\n        }\r\n\r\n        this.uploader = uploader;\r\n        this.options = opts;\r\n        this.build = build;\r\n        this.preview = preview;\r\n        this.setState = setState;\r\n        this.refreshButton = refreshButton;\r\n        this.getFileView = getFileView;\r\n        this.getFileViewSelector = getFileViewSelector;\r\n        this.addFileView = addFile;\r\n        this.removeUploadFileView = removeUploadFile;\r\n        this.isImage = isImage;\r\n        this.getColumn = function () {\r\n            return updateColumn;\r\n        };\r\n\r\n        function supportIe() {\r\n            if (!WebUploader.Uploader.support('flash') && WebUploader.browser.ie) {\r\n\r\n                // flash 安装了但是版本过低。\r\n                if (flashVersion) {\r\n                    (function (container) {\r\n                        window['expressinstallcallback'] = function (state) {\r\n                            switch (state) {\r\n                                case 'Download.Cancelled':\r\n                                    break;\r\n\r\n                                case 'Download.Failed':\r\n                                    Dcat.error('Install failed!');\r\n                                    break;\r\n\r\n                                default:\r\n                                    Dcat.success('Install Success！');\r\n                                    break;\r\n                            }\r\n                            delete window['expressinstallcallback'];\r\n                        };\r\n\r\n                        var swf = './expressInstall.swf';\r\n                        // insert flash object\r\n                        var html = `<object type=\"application/x-shockwave-flash\" data=\"${swf}\" `;\r\n\r\n                        if (WebUploader.browser.ie) {\r\n                            html += 'classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" ';\r\n                        }\r\n\r\n                        html += `width=\"100%\" height=\"100%\" style=\"outline:0\">\r\n                            <param name=\"movie\" value=\"${swf}\" />\r\n                            <param name=\"wmode\" value=\"transparent\" />\r\n                            <param name=\"allowscriptaccess\" value=\"always\" />\r\n                            </object>`;\r\n\r\n                        container.html(html);\r\n\r\n                    })($wrap);\r\n\r\n                } else {\r\n                    $wrap.html('<a href=\"http://www.adobe.com/go/getflashplayer\" target=\"_blank\" border=\"0\"><img alt=\"get flash player\" src=\"http://www.adobe.com/macromedia/style_guide/images/160x41_Get_Flash_Player.jpg\" /></a>');\r\n                }\r\n\r\n                return;\r\n            } else if (!WebUploader.Uploader.support()) {\r\n                Dcat.error('您的浏览器不支持Web Uploader！');\r\n                return;\r\n            }\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    Dcat.Uploader = function (options) {\r\n        return new Uploader(options)\r\n    };\r\n\r\n})(window, jQuery);"],"sourceRoot":""}